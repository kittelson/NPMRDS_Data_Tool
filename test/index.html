<!DOCTYPE html>
<html>
<head>
<html lang="en">
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
	<svg width="2000" height="5000" font-family="sans-serif" font-size="10" text-anchor="middle">
	<rect width = "1500" height = "700" fill = "#f4f4f4"></rect>
	</svg>
<script>
	
	var svg = d3.select("svg"),
		width = svg.attr("width"),
		height = svg.attr("height");
	d3.json("new.json", function(error, combinedData) {
		if(error) return console.warn(error);
		data = combinedData.data;
		meta = combinedData.meta;		
		visualization();
	});

	function visualization() {
		//user defined variables
		var num_of_students = data.length,
			num_of_rows = 3,
			curvature = 0.1;
			max_score = 100;
			part2 = 500;
			width = width-part2;
		
		var num_of_cols = 4,
			gridSize = 220,
			col = 0,
			row = 0;
	
	
		var canvas = svg.append("g")
						.attr("transform", "translate(0,0)")
						.attr("id", "canvas");
						
		for(var i = 0; i < num_of_students; i++) {
			var x = colFunction(i);
			var y = rowFunction(i);							
		
			group = canvas.append("g")
						  .attr("id", data[i].id)
						  .attr("x", x)
						  .attr("y", y)
									
			group.append("rect")
				  .attr("x", x)
				  .attr("y", y)
				  .attr("rx", gridSize*curvature)
				  .attr("ry", gridSize*curvature)
				  .attr("width", gridSize)
				  .attr("height", gridSize)
				  .attr("stroke", "grey")
				  .style("fill", "white");
			
					
			var keys = Object.keys(data[i].scores);
			var num_of_parameters = 0;
			keys.forEach(function(key) {
				num_of_parameters = num_of_parameters + 1;
			})
			
			var gap = parseFloat(gridSize * (curvature));
			var w1 = parseFloat(gridSize-(2*gap))/parseFloat(num_of_parameters);
			var a1 = 0;

			keys.forEach(function (key){
				var h1 = (data[i].scores[key]/max_score)*(gridSize-(gap*2));
				var y1 = y - gap - h1;
				group.append("rect")
					  .attr("x",x + gap +a1*w1)
					  .attr("y", y + gridSize - gap - (data[i].scores[key]/max_score)*(gridSize-(gap*2)))
					  .attr("width", w1)
					  .attr("height",h1)
					  .attr("stroke", "grey")
					  .attr("opacity", ".8")
					  .style("fill", "black");
				a1 = a1 + 1;
		})
		}
		
		function colFunction(i) {		
			if(col < num_of_cols) {
				col = col + 1;
			} else {
				col = 1;
			}
			return (col-1) * gridSize;
		}
		
		function rowFunction(i) {
			row = Math.floor(i / num_of_cols);
			return row*gridSize;
		}
	}

	</script>
</body>
</html>